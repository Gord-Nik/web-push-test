# Web Push Demo ‚Äì Spring¬†Boot¬†+¬†Nginx¬†+¬†mkcert

This repository shows the **minimal, production‚Äësafe** way to send browser Web¬†Push notifications from a Java/Spring¬†Boot backend to Chrome/Firefox.

---

## 0¬†¬†Prerequisites

* **Ubuntu¬†20.04¬†+** (tested on¬†24.04)¬†‚Äî any Linux will work
* **JDK¬†17¬†–∏–ª–∏¬†21**
  `sdk install java 21-tem` / `sudo apt install openjdk-17-jdk`
* **Gradle¬†8** (–æ–±—ë—Ä—Ç–∫–∞ —É–∂–µ –≤ –ø—Ä–æ–µ–∫—Ç–µ) –∏–ª–∏ Maven 3.9
* **Node¬†18+** ‚Äì —Ç–æ–ª—å–∫–æ —á—Ç–æ–±—ã –æ–¥–∏–Ω —Ä–∞–∑ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å VAPID‚Äë–∫–ª—é—á–∏
  `nvm install 18`
* **mkcert** + **Nginx** (–¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ HTTPS)
* –ü–æ—Ä—Ç¬†`8080` —Å–≤–æ–±–æ–¥–µ–Ω –¥–ª—è Spring, `443`¬†‚Äî –¥–ª—è Nginx

---

## 1¬†¬†TLS –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

### 1.1¬†¬†–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å mkcert –∏ Nginx

```
sudo apt update && sudo apt install nginx libnss3-tools -y
sudo snap install mkcert  # –∏–ª–∏ brew/linuxbrew install mkcert
mkcert -install           # –¥–æ–±–∞–≤–ª—è–µ—Ç CA –≤ trust‚Äëstore Chrome/Firefox
mkcert localhost 127.0.0.1 ::1
sudo mkdir -p /etc/nginx/certs
sudo mv localhost*.pem /etc/nginx/certs/
```

### 1.2¬†¬†–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è /etc/nginx/sites-available/localhost-ssl.conf

```
server {
    listen 443 ssl http2;
    server_name localhost 127.0.0.1;

    ssl_certificate     /etc/nginx/certs/localhost.pem;
    ssl_certificate_key /etc/nginx/certs/localhost-key.pem;

    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers   HIGH:!aNULL:!MD5;

    location / {
        proxy_pass         http://127.0.0.1:8080;
        proxy_set_header   Host $host;
        proxy_set_header   X-Real-IP $remote_addr;
        proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header   X-Forwarded-Proto https;
    }
}
server { listen 80; server_name localhost 127.0.0.1; return 301 https://$host$request_uri; }
```

```
sudo ln -s /etc/nginx/sites-available/localhost-ssl.conf /etc/nginx/sites-enabled/
sudo nginx -t && sudo systemctl reload nginx
```

–¢–µ–ø–µ—Ä—å **[https://localhost](https://localhost)** –æ—Ç–¥–∞—ë—Ç Spring‚Äë–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ.

---

## 2¬†¬†–ì–µ–Ω–µ—Ä–∞—Ü–∏—è VAPID‚Äë–∫–ª—é—á–µ–π

```
npx web-push generate-vapid-keys --json > vapid.json
cat vapid.json
#  "publicKey":  "BP‚Ä¶88¬†—Å–∏–º–≤."
#  "privateKey": "WS‚Ä¶43¬†—Å–∏–º–≤."
```

* –°–∫–æ–ø–∏—Ä—É–π—Ç–µ `publicKey` –≤ **frontend** (`index.html`, –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è `vapid`)
* –°–∫–æ–ø–∏—Ä—É–π—Ç–µ `publicKey` –∏ `privateKey` –≤ **backend** `src/main/resources/application.yml`:

```
push:
  vapid:
    public:  BP...
    private: WS...
    subject: mailto:dev@example.com
```

(–ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π privateKey –ª—É—á—à–µ —Ö—Ä–∞–Ω–∏—Ç—å –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏–ª–∏ Vault.)

–ü–æ—Å–ª–µ —Å–º–µ–Ω—ã –∫–ª—é—á–µ–π **–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ** —É–¥–∞–ª—è–π—Ç–µ —Å—Ç–∞—Ä—ã–µ –ø–æ–¥–ø–∏—Å–∫–∏ –≤ –±—Ä–∞—É–∑–µ—Ä–µ.

---

## 3¬†¬†–°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫ backend

```
./gradlew clean bootRun   # –∏–ª–∏ mvn spring-boot:run
```

Backend —Å—Ç–∞—Ä—Ç—É–µ—Ç –Ω–∞¬†`localhost:8080`, Nginx –ø—Ä–æ–∫—Å–∏—Ä—É–µ—Ç ‚Üí `https://localhost`.
–õ–æ–≥–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º —Å—Ç–∞—Ä—Ç–µ:

* `‚úÖ  Bouncy Castle provider registered`
* `Started DemoPushApplication`

---

## 4¬†¬†–§—Ä–æ–Ω—Ç–µ–Ω–¥‚Äë—á–∞—Å—Ç—å

–í –ø—Ä–æ–µ–∫—Ç–µ —É–∂–µ –ª–µ–∂–∞—Ç —Ñ–∞–π–ª—ã:

* `src/main/resources/static/index.html` ‚Äì –∫–Ω–æ–ø–∫–∞ ¬´Subscribe &¬†Send¬ª
* `src/main/resources/static/sw.js` ‚Äì Service¬†Worker —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π *push*

–ü—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ `https://localhost`:

1. –ë—Ä–∞—É–∑–µ—Ä –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –Ω–∞ notifications ‚Üí –Ω–∞–∂–º–∏—Ç–µ **Allow**.
2. Service¬†Worker —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è, –ø–æ–¥–ø–∏—Å–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ `/api/push/subscribe/{user}`.
3. Backend –ø–æ REST `/api/push/notify/{user}` –º–≥–Ω–æ–≤–µ–Ω–Ω–æ —à–ª—ë—Ç —Ç–µ—Å—Ç–æ–≤—ã–π push (JSON `{title, body}`), FCM –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç **201¬†Created**.
4. –ù–∞ —Ä–∞–±–æ—á–µ–º —Å—Ç–æ–ª–µ GNOME/Windows –≤—Å–ø–ª—ã–≤–∞–µ—Ç –±–∞–Ω–Ω–µ—Ä ¬´Hello¬†/¬†It¬†works!¬ª.

---

## 5¬†¬†–ß–∞—Å—Ç—ã–µ –æ—à–∏–±–∫–∏ –∏ —Ä–µ—à–µ–Ω–∏—è

| –°–∏–º–ø—Ç–æ–º                                                  | –†–µ—à–µ–Ω–∏–µ                                                                                         |
| -------------------------------------------------------- | ----------------------------------------------------------------------------------------------- |
| 403¬†Forbidden + *‚Äúcrypto-key header had invalid format‚Äù* | –í—ã–∑—ã–≤–∞–π—Ç–µ `client.send(notification, Encoding.AES128GCM)`, –ø–µ—Ä–µ—Å–æ–∑–¥–∞–π—Ç–µ –ø–æ–¥–ø–∏—Å–∫—É.               |
| 403¬†Forbidden + *‚ÄúUnauthorizedRegistration‚Äù*             | –ü–æ–¥–ø–∏—Å–∫–∞ —É—Å—Ç–∞—Ä–µ–ª–∞. –£–¥–∞–ª–∏—Ç–µ –∏ –ø–æ–¥–ø–∏—à–∏—Ç–µ—Å—å –∑–∞–Ω–æ–≤–æ.                                                |
| `SecurityError: Service Worker registration failed`      | –°—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–µ –ø–æ HTTPS, –ª–∏–±–æ `sw.js`¬†‚Äî¬†404. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å DevTools¬†‚Üí Network.                         |
| –ë–∞–Ω–Ω–µ—Ä –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è, —Ö–æ—Ç—è 201                         | –í–∫–ª–∞–¥–∫–∞ –∞–∫—Ç–∏–≤–Ω–∞ –ª–∏–±–æ OS‚Äënotifications –≤—ã–∫–ª—é—á–µ–Ω—ã. –ó–∞–∫—Ä–æ–π—Ç–µ –≤–∫–ª–∞–¥–∫—É / –ø—Ä–æ–≤–µ—Ä—å—Ç–µ ¬´Do¬†Not¬†Disturb¬ª. |

---

üéâ¬†–¢–µ–ø–µ—Ä—å —É –≤–∞—Å –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—á–∏–π —Å—Ç–µ–∫ –¥–ª—è Web¬†Push‚Äë—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–º HTTPS‚Äë—Å—Ç–µ–Ω–¥–µ.
